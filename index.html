<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div style="text-align:center;">
        <h1>ESP32 CONTROL PANEL</h1>
        <h3>Motor</h3>
        <button onclick="turnMotorOn()">Start</button>
        <button onclick="turnMotorOff()">Stop</button>
        <br>
        <button onclick="motorForward()">Forward</button>
        <button onclick="motorBackward()">Backward</button>
        <br>
        <button onclick="motorDecrease()">Decrease</button>
        <button onclick="motorIncrease()">Increase</button>
        <br>
        Current speed: <span id="speed"></span><br>
        Direction: <span id="direction"></span><br>
        Motor state: <span id="motor_state"></span><br>
        <h3>Servo</h3>
        <button onclick="turnLeft()">Left</button>
        <button onclick="turnRight()">Right</button>
        <br>
        Valor del servo: <span id="servo"></span>
        <h3>Messages</h3>
        <span id='message'></span>
    </div>
    <script>
        var somePackage = {};
        somePackage.connect = function()  {
            var ws = new WebSocket('ws://192.168.4.1:81');
            ws.onopen = function() {
                console.log('ws connected');
                somePackage.ws = ws;
            };
            ws.onerror = function() {
                console.log('ws error');
            };
            ws.onclose = function() {
                console.log('ws closed');
            };
            ws.onmessage = function(msgevent) {
                var json_data = JSON.parse(msgevent.data);
                var msg = msgevent.data;
                if (json_data["servoState"]) {
                  document.getElementById("servo").innerHTML = json_data["servoState"];
                }
                if (json_data["message"]) {
                  document.getElementById("message").innerHTML = json_data["message"];
                }
                if (json_data["speed"]) {
                  document.getElementById("speed").innerHTML = json_data["speed"];
                }
                if (json_data["motorDir"]) {
                  document.getElementById("direction").innerHTML = json_data["motorDir"];
                }
                if (json_data["motorState"]) {
                  document.getElementById("motor_state").innerHTML = json_data["motorState"];
                }

                console.log('in :', msg);
                // message received, do something
            };
        };

        somePackage.send = function(msg) {
            if (!this.ws) {
                console.log('no connection');
                return;
            }
            console.log('out:', msg)
            //this.ws.send(window.JSON.stringify(msg));
            this.ws.send(msg);
        };
        somePackage.connect();
        const turnLeft = () => somePackage.send("Left");
        const turnRight = () => somePackage.send("Right");
        const turnMotorOn = () => somePackage.send("Motor_on");
        const turnMotorOff = () => somePackage.send("Motor_off");
        const motorForward = () => somePackage.send("Motor_forward");
        const motorBackward = () => somePackage.send("Motor_backward");
        const motorDecrease = () => somePackage.send("Motor_decrease");
        const motorIncrease = () => somePackage.send("Motor_increase");
    </script>
</body>
</html>
